id: xyz.mx_moment.moment
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15-21.08'
command: moment
finish-args:
- --share=ipc
- --share=network
- --socket=fallback-x11
- --socket=wayland
- --socket=pulseaudio
- --device=dri
- --talk-name=org.freedesktop.Notifications
rename-icon: moment
rename-desktop-file: moment.desktop
rename-appdata-file: moment.metainfo.xml
cleanup:
- /app/include
- /app/usr/tests
- /app/lib/cmake
- /app/bin/cairosvg
- /app/bin/chardetect
- /app/bin/futurize
- /app/bin/jsonschema
- /app/bin/pasteurize
- /app/bin/pwiz.py
modules:
- name: pyotherside
  buildsystem: qmake
  make-install-args:
  - INSTALL_ROOT=/app
  post-install:
  - mkdir -p /app/lib/qml
  - ln -s /app/usr/lib/qml/io /app/lib/qml
  sources:
  - type: archive
    url: https://github.com/thp/pyotherside/archive/1.5.9.tar.gz
    sha256: 189cb0b973e40fcb6b95fd51b0bcd6cc8494b514d49ffe966ec488cf05bbf51e
- name: olm
  buildsystem: cmake-ninja
  sources:
  - type: git
    url: https://gitlab.matrix.org/matrix-org/olm.git
    tag: 3.2.2
    commit: 3745ea57bbce319ac2f190e02062e45a46d23471
  disable-shallow-clone: true
  config-opts:
  - -DCMAKE_BUILD_TYPE=Release
- name: libzen
  subdir: Project/GNU/Library
  config-opts:
  - --enable-shared
  - --disable-static
  cleanup:
  - /bin
  - /include
  - /lib/pkgconfig
  - /lib/*.la
  sources:
  - type: archive
    url: https://mediaarea.net/download/source/libzen/0.4.37/libzen_0.4.37.tar.xz
    sha256: 38c0a68b715b55d6685d2759eecda040adf37bd066955d79a5d01f91977bd9a0
- name: libmediainfo
  subdir: Project/GNU/Library
  config-opts:
  - --enable-shared
  - --disable-static
  - --with-libcurl
  cleanup:
  - /bin
  - /include
  - /lib/pkgconfig
  - /lib/*.la
  sources:
  - type: archive
    url: https://mediaarea.net/download/source/libmediainfo/19.09/libmediainfo_19.09.tar.xz
    sha256: ff06e1a449dfbe6f2c51f27ae1187d3e72386cb54476fbb189ffaacf845f478e

- "python3-modules.json"

- name: moment
  buildsystem: qmake
  post-install:
  # This works around a bug in appstream-glib where it won't find the icon if
  # /usr exists. For some reason.
  - ln -s /app/share /app/usr
  sources:
  - type: git
    url: https://gitlab.com/mx-moment/moment.git
    tag: v0.7.3
    commit: f3c23f0d889b7e0eda272e31e8536c4fc1e26e0e
    x-checker-data:
      type: "git"
      tag-pattern: "^v([\\d.]+)$"
  - type: patch
    path: 3504c45a476caf959735923e7296d232ba836c3f.patch
  - type: patch
    path: 6d246a5d9f2f93d4b3297c96301c7d0b5fbb59f4.patch
  - type: patch
    path: 79fa465c1aa7a1e96421881a78d216d37fa2f1a4.patch
